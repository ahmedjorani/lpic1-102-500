# 1.11 - Working with Variables
##### LPIC-1: Linux Administrator (102-500)

## Learning Objectives

At the end of this lesson, you will be able to:

1. **Understand** the key features and uses of variables in Linux
2. **Create, modify, and manage** variables effectively
3. **Distinguish** between local and global variables
4. **Configure** shell environments using various configuration files
5. **Apply** variables in practical scripting scenarios

---

## What Are Variables?

Variables are named storage containers that hold data values. They are fundamental building blocks in shell scripting and system administration.

### Key Uses of Variables

- **Store Information**: Hold data for later use
- **Enable Reusability**: Use the same data multiple times without retyping
- **Centralize Changes**: Modify data in one place to affect entire scripts
- **Dynamic Content**: Store command outputs and user inputs

---

## Shell Configuration Files

Understanding where variables can be defined helps you configure your system effectively.

### Bash-Specific Configuration Files

| File | Scope | When Loaded | Purpose |
|------|-------|-------------|---------|
| `/etc/bashrc` | System-wide | Non-login shells | Global bash settings |
| `~/.bash_profile` | User-specific | Login shells | User's login environment |
| `~/.bashrc` | User-specific | Non-login shells | User's interactive bash settings |

```bash
# Example: Adding a variable to ~/.bashrc
echo 'export EDITOR="vim"' >> ~/.bashrc
# This sets vim as the default editor for all new bash sessions
```

### Generic Shell Configuration Files

| File | Scope | Purpose |
|------|-------|---------|
| `/etc/profile` | System-wide | Login environment for all shells |
| `/etc/profile.d/*` | System-wide | Modular system configurations |
| `~/.profile` | User-specific | User's login environment (shell-independent) |

```bash
# Example: Adding a custom PATH to ~/.profile
echo 'export PATH="$PATH:$HOME/bin"' >> ~/.profile
# This adds ~/bin to the PATH for all shell types
```

---

## Working with Variables

### Viewing Existing Variables

```bash
# Display all environment variables
env
# Shows variables like PATH, HOME, USER, etc.

# Display all variables (including shell variables)
set
# Shows both environment and shell variables

# Display specific variable
echo $HOME
# Output: /home/username

# Check if variable exists
echo ${MYVAR:-"Variable not set"}
# Output: "Variable not set" if MYVAR doesn't exist
```

### Creating Local Variables

Local variables exist only in the current shell session.

```bash
# Create a simple variable
EXAMPLE="Hello World"
# Note: No spaces around the = sign!

# Display the variable
echo $EXAMPLE
# Output: Hello World

# Another example with numbers
COUNT=42
echo "The count is: $COUNT"
# Output: The count is: 42
```

### Combining Variables

```bash
# Create individual variables
FIRSTNAME="John"
LASTNAME="Doe"

# Combine them into a new variable
FULLNAME="$FIRSTNAME $LASTNAME"
echo $FULLNAME
# Output: John Doe

# Alternative syntax with curly braces (safer)
FULLNAME="${FIRSTNAME} ${LASTNAME}"
echo "Welcome, $FULLNAME!"
# Output: Welcome, John Doe!

# Concatenating with additional text
EMAIL="${FIRSTNAME}.${LASTNAME}@company.com"
echo $EMAIL
# Output: John.Doe@company.com
```

### Command Substitution in Variables

Store the output of commands in variables for later use.

```bash
# Store current username
USERNAME=$(whoami)
echo "Current user: $USERNAME"
# Output: Current user: john

# Store current date
TODAY=$(date +%Y-%m-%d)
echo "Today is: $TODAY"
# Output: Today is: 2025-09-05

# Store file count in current directory
FILECOUNT=$(ls -1 | wc -l)
echo "Files in current directory: $FILECOUNT"
# Output: Files in current directory: 15

# Alternative syntax (older, but still valid)
HOSTNAME=`hostname`
echo "This server: $HOSTNAME"
# Output: This server: myserver
```

### Global Variables (Environment Variables)

Convert local variables to environment variables using `export`.

```bash
# Create a local variable first
MYAPP_CONFIG="/etc/myapp/config.conf"

# Export it to make it available to child processes
export MYAPP_CONFIG

# Or create and export in one step
export DATABASE_URL="postgresql://localhost:5432/mydb"

# Verify it's exported
env | grep MYAPP_CONFIG
# Output: MYAPP_CONFIG=/etc/myapp/config.conf
```

### Automatic Export of All Variables

```bash
# Enable automatic export of all variables
set -o allexport

# Now any variable you create will be automatically exported
SERVER_NAME="production-web-01"
API_KEY="abc123def456"

# Disable automatic export
set +o allexport

# Add to ~/.profile for permanent effect
echo 'set -o allexport' >> ~/.profile
```

### Reloading Configuration Files

```bash
# Reload ~/.profile without logging out
source ~/.profile
# Alternative syntax
. ~/.profile

# Reload ~/.bashrc
source ~/.bashrc

# Reload system profile
source /etc/profile
```

---

## Variable Best Practices

### Naming Conventions

```bash
# Good: Descriptive, uppercase for environment variables
export DATABASE_HOST="localhost"
export LOG_LEVEL="INFO"

# Good: Lowercase for local script variables
script_name="backup.sh"
temp_file="/tmp/processing.tmp"

# Avoid: Unclear names
x="localhost"        # What is x?
data="INFO"          # What kind of data?
```

### Quoting Variables

```bash
# Always quote variables to handle spaces and special characters
filename="my document.txt"

# Wrong: Will fail if filename contains spaces
rm $filename

# Correct: Quotes protect against word splitting
rm "$filename"

# Wrong: Command injection risk
user_input="test; rm -rf /"
echo $user_input

# Better: Quotes prevent command injection
echo "$user_input"
```

### Default Values

```bash
# Provide default values for undefined variables
PORT=${PORT:-8080}
echo "Using port: $PORT"
# Uses 8080 if PORT is not set

# Different default value syntax
CONFIG_FILE=${CONFIG_FILE:="/etc/app/default.conf"}
echo "Config file: $CONFIG_FILE"

# Required variables (exit if not set)
DATABASE_PASSWORD=${DATABASE_PASSWORD:?Error: DATABASE_PASSWORD must be set}
```

---

## Common Variable Examples

### System Information Variables

```bash
# User and system info
echo "User: $USER"
echo "Home: $HOME"
echo "Shell: $SHELL"
echo "Path: $PATH"

# Current working directory
echo "Current directory: $PWD"

# Process ID of current shell
echo "Shell PID: $$"
```

### Custom Application Variables

```bash
# Web application configuration
export WEBAPP_PORT=3000
export WEBAPP_ENV="development"
export WEBAPP_DEBUG="true"

# Database configuration
export DB_HOST="localhost"
export DB_PORT=5432
export DB_NAME="myapp_dev"
export DB_USER="developer"

# Logging configuration
export LOG_DIR="/var/log/myapp"
export LOG_LEVEL="DEBUG"
```

---

## Troubleshooting Variables

### Common Issues and Solutions

```bash
# Issue: Variable not found
echo $NONEXISTENT
# Output: (empty)

# Solution: Check if it exists
if [ -z "$NONEXISTENT" ]; then
    echo "Variable NONEXISTENT is not set or empty"
fi

# Issue: Variable not available in script
# Check if it's exported
env | grep MYVAR

# Issue: Spaces in assignment (wrong)
VAR = "value"     # Error: command not found

# Correct way
VAR="value"       # No spaces around =

# Issue: Variable not persisting across sessions
# Solution: Add to appropriate config file
echo 'export MYVAR="value"' >> ~/.bashrc
```

---

## Summary

- **Variables** store data for reuse and dynamic content
- **Local variables** exist only in the current shell session
- **Environment variables** (exported) are available to child processes
- **Configuration files** control where variables are defined and loaded
- **Best practices** include proper naming, quoting, and default values
- **Command substitution** allows storing command output in variables

## Next Steps

Practice using variables in the accompanying lab to reinforce these concepts and prepare for real-world scenarios.