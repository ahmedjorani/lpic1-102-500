# 1.21 - Basic Scripting
##### LPIC-1: Linux Administrator (102-500)

## Learning Objectives

At the end of this lesson, you will be able to:

1. **Understand** the essential elements of shell scripts
2. **Create** basic scripts for system administration tasks
3. **Use** fundamental commands like echo, read, and test effectively
4. **Implement** basic control structures and user interaction
5. **Apply** scripting best practices for reliable automation

---

## Script Fundamentals

### Basic Script Structure

Every shell script should follow a standard structure for clarity and reliability.

```bash
#!/bin/bash
# Script: sample.sh
# Purpose: Demonstrate basic scripting structure
# Author: Your Name
# Date: $(date +%Y-%m-%d)

# Variable declarations
SCRIPT_NAME="Sample Script"
VERSION="1.0"

# Main script logic
echo "Running $SCRIPT_NAME version $VERSION"
echo "Script executed on: $(date)"
```

**Key Elements:**
- **Shebang (`#!/bin/bash`)**: Tells the system which interpreter to use
- **Comments**: Document purpose, author, and functionality
- **Variables**: Store reusable data
- **Logic**: The actual commands and operations

### Making Scripts Executable

```bash
# Create a script file
cat > hello.sh << 'EOF'
#!/bin/bash
echo "Hello, World!"
EOF

# Make it executable
chmod +x hello.sh

# Run the script
./hello.sh
# Output: Hello, World!

# Alternative ways to run scripts
bash hello.sh        # Run with bash interpreter
sh hello.sh          # Run with sh interpreter
source hello.sh      # Run in current shell (no new process)
```

### Script Permissions Explained

```bash
# View current permissions
ls -l hello.sh
# Output: -rw-r--r-- 1 user group 25 date hello.sh

# Add execute permission for owner
chmod u+x hello.sh
ls -l hello.sh
# Output: -rwxr--r-- 1 user group 25 date hello.sh

# Add execute permission for everyone
chmod a+x hello.sh
ls -l hello.sh
# Output: -rwxr-xr-x 1 user group 25 date hello.sh

# Numeric permissions (common practice)
chmod 755 hello.sh   # rwxr-xr-x (owner: rwx, group: rx, others: rx)
chmod 700 hello.sh   # rwx------ (owner only)
```

---

## Essential Commands

### The `echo` Command

The `echo` command displays text and is fundamental for script output.

```bash
#!/bin/bash
# Demonstrating echo command variations

# Basic text output
echo "Welcome to Basic Scripting!"

# Output without newline (-n flag)
echo -n "Enter your name: "
read name
echo "Hello, $name!"

# Enable interpretation of backslash escapes (-e flag)
echo -e "Line 1\nLine 2\nLine 3"        # \n = newline
echo -e "Tab\tSeparated\tValues"         # \t = tab
echo -e "Bell sound: \a"                 # \a = bell/alert
echo -e "Colored text: \033[31mRed\033[0m"  # ANSI color codes

# Combining variables with text
USER="Administrator"
echo "Current user: $USER"
echo "System uptime: $(uptime)"

# Special characters need quotes
echo "Today's date: $(date)"             # Single quotes prevent variable expansion
echo 'Literal text: $USER and $(date)'   # Variables not expanded
```

### The `read` Command

The `read` command captures user input into variables.

```bash
#!/bin/bash
# Demonstrating read command variations

# Basic input
echo "What's your name?"
read username
echo "Hello, $username!"

# Prompt with read (-p flag)
read -p "Enter your age: " age
echo "You are $age years old"

# Silent input for passwords (-s flag)
read -s -p "Enter password: " password
echo  # Add newline after silent input
echo "Password captured (not displayed)"

# Input with timeout (-t flag)
read -t 10 -p "Enter response within 10 seconds: " response
if [ $? -eq 0 ]; then
    echo "You entered: $response"
else
    echo "Timeout! Using default value."
    response="default"
fi

# Reading multiple values
read -p "Enter first and last name: " firstname lastname
echo "First: $firstname, Last: $lastname"

# Reading into an array
echo "Enter three favorite colors (space-separated):"
read -a colors
echo "Color 1: ${colors[0]}"
echo "Color 2: ${colors[1]}"
echo "Color 3: ${colors[2]}"
```

### The `test` Command

The `test` command evaluates conditions and returns true or false.

```bash
#!/bin/bash
# Demonstrating test command variations

# File testing
filename="/etc/passwd"

# Test if file exists
if test -f "$filename"; then
    echo "$filename exists"
else
    echo "$filename does not exist"
fi

# Alternative bracket syntax (preferred)
if [ -f "$filename" ]; then
    echo "$filename exists and is a regular file"
fi

# Directory testing
if [ -d "/home" ]; then
    echo "/home directory exists"
fi

# Permission testing
if [ -r "$filename" ]; then
    echo "$filename is readable"
fi

if [ -w "$filename" ]; then
    echo "$filename is writable"
else
    echo "$filename is not writable"
fi

# String comparisons
user1="admin"
user2="guest"

if [ "$user1" = "$user2" ]; then
    echo "Users are the same"
else
    echo "Users are different"
fi

# String length testing
if [ -z "$user1" ]; then
    echo "user1 is empty"
else
    echo "user1 is not empty: $user1"
fi

# Numeric comparisons
num1=10
num2=20

if [ "$num1" -lt "$num2" ]; then
    echo "$num1 is less than $num2"
fi

if [ "$num1" -eq 10 ]; then
    echo "$num1 equals 10"
fi
```

---

## Control Structures

### If/Then/Else Statements

Control the flow of your script based on conditions.

```bash
#!/bin/bash
# Demonstrating if/then/else structures

# Simple if statement
score=85

if [ "$score" -ge 90 ]; then
    echo "Excellent! Grade: A"
elif [ "$score" -ge 80 ]; then
    echo "Good job! Grade: B"
elif [ "$score" -ge 70 ]; then
    echo "Satisfactory. Grade: C"
elif [ "$score" -ge 60 ]; then
    echo "Needs improvement. Grade: D"
else
    echo "Failed. Grade: F"
fi

# Testing multiple conditions
read -p "Enter a filename: " filename

if [ -f "$filename" ] && [ -r "$filename" ]; then
    echo "File exists and is readable"
    echo "File size: $(stat -c%s "$filename") bytes"
elif [ -f "$filename" ]; then
    echo "File exists but is not readable"
else
    echo "File does not exist"
fi

# Nested if statements
read -p "Enter your username: " username

if [ -n "$username" ]; then
    if [ -d "/home/$username" ]; then
        echo "User $username has a home directory"
        if [ -w "/home/$username" ]; then
            echo "Home directory is writable"
        else
            echo "Home directory is not writable"
        fi
    else
        echo "User $username does not have a home directory"
    fi
else
    echo "No username provided"
fi
```

### For Loops

Execute commands repeatedly for each item in a list.

```bash
#!/bin/bash
# Demonstrating for loops

# Loop through a list of items
echo "Checking system users:"
for user in root daemon bin sys sync; do
    if [ -d "/home/$user" ]; then
        echo "  $user: has home directory"
    else
        echo "  $user: no home directory"
    fi
done

# Loop through files in a directory
echo "Files in /etc ending with .conf:"
for file in /etc/*.conf; do
    if [ -f "$file" ]; then
        echo "  $(basename "$file"): $(stat -c%s "$file") bytes"
    fi
done

# Loop through command line arguments
echo "Script arguments:"
for arg in "$@"; do
    echo "  Argument: $arg"
done

# Loop with sequence numbers
echo "Countdown:"
for i in $(seq 5 -1 1); do
    echo "  $i..."
    sleep 1
done
echo "  Blast off!"

# C-style for loop
echo "Even numbers from 2 to 10:"
for ((i=2; i<=10; i+=2)); do
    echo "  $i"
done
```

### While Loops

Execute commands repeatedly while a condition is true.

```bash
#!/bin/bash
# Demonstrating while loops

# Basic while loop
counter=1
echo "Counting to 5:"
while [ $counter -le 5 ]; do
    echo "  Count: $counter"
    counter=$((counter + 1))  # Increment counter
done

# Reading file line by line
echo "Reading /etc/passwd (first 5 lines):"
line_count=0
while read -r line; do
    line_count=$((line_count + 1))
    echo "  Line $line_count: $(echo "$line" | cut -d: -f1)"  # Show username only
    if [ $line_count -ge 5 ]; then
        break  # Exit loop after 5 lines
    fi
done < /etc/passwd

# Menu system with while loop
while true; do
    echo
    echo "=== System Menu ==="
    echo "1. Show date"
    echo "2. Show uptime"
    echo "3. Show disk usage"
    echo "4. Exit"
    read -p "Choose an option (1-4): " choice
    
    case $choice in
        1) echo "Current date: $(date)" ;;
        2) echo "System uptime: $(uptime)" ;;
        3) echo "Disk usage:"; df -h / ;;
        4) echo "Goodbye!"; break ;;
        *) echo "Invalid option. Please try again." ;;
    esac
done

# While loop with user input validation
while true; do
    read -p "Enter a number between 1 and 10: " number
    if [[ "$number" =~ ^[0-9]+$ ]] && [ "$number" -ge 1 ] && [ "$number" -le 10 ]; then
        echo "Valid number: $number"
        break
    else
        echo "Invalid input. Please enter a number between 1 and 10."
    fi
done
```

### The `seq` Command

Generate sequences of numbers for loops and calculations.

```bash
#!/bin/bash
# Demonstrating seq command

# Basic sequence
echo "Numbers 1 to 5:"
for i in $(seq 1 5); do
    echo "  $i"
done

# Sequence with step
echo "Even numbers from 2 to 10:"
for i in $(seq 2 2 10); do
    echo "  $i"
done

# Descending sequence
echo "Countdown from 10 to 1:"
for i in $(seq 10 -1 1); do
    echo "  $i"
done

# Sequence with decimal places
echo "Decimal sequence:"
for i in $(seq 1 0.5 3); do
    echo "  $i"
done

# Using seq for file operations
echo "Creating 5 test files:"
for i in $(seq 1 5); do
    touch "testfile_$i.txt"
    echo "  Created: testfile_$i.txt"
done

# Cleanup
rm -f testfile_*.txt
echo "Test files removed"
```

---

## User Interaction Examples

### Complete User Input Script

```bash
#!/bin/bash
# Complete user interaction example

echo "=== User Registration System ==="

# Get user information
read -p "Enter username: " username
read -p "Enter full name: " fullname
read -s -p "Enter password: " password
echo  # Newline after password input

# Validate input
if [ -z "$username" ] || [ -z "$fullname" ] || [ -z "$password" ]; then
    echo "Error: All fields are required!"
    exit 1
fi

# Check if user already exists
if id "$username" &>/dev/null; then
    echo "Error: User $username already exists!"
    exit 1
fi

# Display confirmation
echo
echo "=== Registration Summary ==="
echo "Username: $username"
echo "Full Name: $fullname"
echo "Password: [HIDDEN]"

read -p "Create this user? (y/N): " confirm
if [ "$confirm" = "y" ] || [ "$confirm" = "Y" ]; then
    echo "User would be created (simulation mode)"
    echo "Commands that would run:"
    echo "  sudo useradd -m -c '$fullname' '$username'"
    echo "  echo '$username:$password' | sudo chpasswd"
else
    echo "User creation cancelled"
fi
```

### Home Directory Checker Script

Enhanced version of the original example from your lesson:

```bash
#!/bin/bash
# Enhanced home directory checker

echo "=== Home Directory Checker ==="

# Get username with validation
while true; do
    read -p "Enter username to check: " username
    if [ -n "$username" ]; then
        break
    else
        echo "Please enter a valid username"
    fi
done

# Check if user exists in system
if ! id "$username" &>/dev/null; then
    echo "Error: User '$username' does not exist in the system"
    exit 1
fi

# Check home directory with detailed information
home_dir="/home/$username"

if [ -d "$home_dir" ]; then
    echo "✓ Home directory exists: $home_dir"
    
    # Additional information
    echo "  Directory details:"
    echo "    Owner: $(stat -c%U "$home_dir")"
    echo "    Group: $(stat -c%G "$home_dir")"
    echo "    Permissions: $(stat -c%A "$home_dir")"
    echo "    Size: $(du -sh "$home_dir" 2>/dev/null | cut -f1)"
    
    # Check accessibility
    if [ -r "$home_dir" ]; then
        echo "    Readable: Yes"
    else
        echo "    Readable: No"
    fi
    
    if [ -w "$home_dir" ]; then
        echo "    Writable: Yes"
    else
        echo "    Writable: No"
    fi
    
else
    echo "✗ Home directory does not exist: $home_dir"
    
    # Suggest creation
    read -p "Would you like to create it? (y/N): " create
    if [ "$create" = "y" ] || [ "$create" = "Y" ]; then
        echo "Commands to create home directory:"
        echo "  sudo mkdir -p '$home_dir'"
        echo "  sudo chown '$username:$username' '$home_dir'"
        echo "  sudo chmod 755 '$home_dir'"
    fi
fi
```

---

## Common Test Operators

### File Test Operators

| Operator | Description | Example |
|----------|-------------|---------|
| `-f file` | True if file exists and is regular file | `[ -f "/etc/passwd" ]` |
| `-d dir` | True if directory exists | `[ -d "/home/user" ]` |
| `-e path` | True if path exists (file or directory) | `[ -e "/tmp" ]` |
| `-r file` | True if file is readable | `[ -r "/etc/shadow" ]` |
| `-w file` | True if file is writable | `[ -w "/tmp" ]` |
| `-x file` | True if file is executable | `[ -x "/bin/bash" ]` |
| `-s file` | True if file exists and is not empty | `[ -s "/var/log/syslog" ]` |

### String Test Operators

| Operator | Description | Example |
|----------|-------------|---------|
| `str1 = str2` | True if strings are equal | `[ "$user" = "admin" ]` |
| `str1 != str2` | True if strings are not equal | `[ "$pass" != "123456" ]` |
| `-z string` | True if string is empty | `[ -z "$var" ]` |
| `-n string` | True if string is not empty | `[ -n "$var" ]` |

### Numeric Test Operators

| Operator | Description | Example |
|----------|-------------|---------|
| `num1 -eq num2` | Equal | `[ "$score" -eq 100 ]` |
| `num1 -ne num2` | Not equal | `[ "$count" -ne 0 ]` |
| `num1 -lt num2` | Less than | `[ "$age" -lt 18 ]` |
| `num1 -le num2` | Less than or equal | `[ "$score" -le 100 ]` |
| `num1 -gt num2` | Greater than | `[ "$temp" -gt 32 ]` |
| `num1 -ge num2` | Greater than or equal | `[ "$score" -ge 60 ]` |

---

## Best Practices

### Error Handling

```bash
#!/bin/bash
# Script with proper error handling

set -e  # Exit on any error
set -u  # Exit on undefined variables

# Function to handle errors
error_exit() {
    echo "Error: $1" >&2
    exit 1
}

# Check if required commands exist
command -v curl >/dev/null 2>&1 || error_exit "curl is required but not installed"

# Validate arguments
if [ $# -eq 0 ]; then
    error_exit "Usage: $0 <filename>"
fi

filename="$1"

# Check file exists before processing
[ -f "$filename" ] || error_exit "File '$filename' does not exist"

echo "Processing file: $filename"
# Rest of script...
```

### Input Validation

```bash
#!/bin/bash
# Input validation examples

# Validate email format
validate_email() {
    local email="$1"
    if [[ "$email" =~ ^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$ ]]; then
        return 0  # Valid
    else
        return 1  # Invalid
    fi
}

# Validate numeric input
validate_number() {
    local input="$1"
    if [[ "$input" =~ ^[0-9]+$ ]]; then
        return 0  # Valid number
    else
        return 1  # Invalid
    fi
}

# Example usage
read -p "Enter your email: " email
if validate_email "$email"; then
    echo "Valid email: $email"
else
    echo "Invalid email format"
fi

read -p "Enter your age: " age
if validate_number "$age"; then
    echo "Valid age: $age"
else
    echo "Invalid age - must be a number"
fi
```

---

## Summary

**Key concepts covered:**
- **Script structure**: Shebang, comments, and organization
- **Essential commands**: echo, read, test with practical examples
- **Control structures**: if/then/else, for loops, while loops
- **User interaction**: Input validation and menu systems
- **Best practices**: Error handling and input validation

**Remember:**
- Always use proper quoting around variables
- Validate user input before processing
- Include error handling for robust scripts
- Test scripts thoroughly before deployment
- Use meaningful variable names and comments

## Next Steps

Practice these concepts in the accompanying lab to build confidence in basic scripting techniques.